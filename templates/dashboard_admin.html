{% extends 'base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <h1 class="page-title">Admin Dashboard</h1>
    <p>Welcome, {{ g.user.username }}! You have admin privileges.</p>

    <section class="dashboard-section">
        <h2>User Management</h2>
        <a href="{{ url_for('admin_create_user') }}" class="btn btn-primary">Create New User</a>
        <div class="user-list" style="margin-top: 20px;">
            <h3>All Registered Users ({{ all_users|length }})</h3>
            {% if all_users %}
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Admin?</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_item in all_users %}
                    <tr>
                        <td>{{ user_item.id }}</td>
                        <td>{{ user_item.username }}</td>
                        <td>{{ "Yes" if user_item.is_admin else "No" }}</td>
                        <td>
                            <a href="{{ url_for('admin_update_user', user_id=user_item.id) }}" class="btn btn-sm btn-info">Edit</a>
                            {% if g.user.id != user_item.id %} {# Can't delete self #}
                            <form action="{{ url_for('admin_delete_user', user_id=user_item.id) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete {{ user_item.username }}? This cannot be undone.');">
                                <input type="submit" value="Delete" class="btn btn-sm btn-danger">
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No users found.</p>
            {% endif %}
        </div>
    </section>

    <section class="dashboard-section">
        <h2>Notifications & Messages</h2>
        <p><a href="{{ url_for('admin_view_messages') }}" class="btn btn-secondary">
            View Messages {% if unread_messages_count > 0 %}<span class="badge badge-danger">{{ unread_messages_count }} new</span>{% endif %}
        </a></p>
    </section>

    <section class="dashboard-section">
        <h2>User Requests</h2>
        <p><a href="{{ url_for('admin_view_requests') }}" class="btn btn-secondary">View User Requests</a></p>
    </section>

</div>

<style>
    .admin-dashboard .dashboard-section { margin-bottom: 30px; padding: 20px; background-color: #f9f9f9; border-radius: 8px; }
    .admin-dashboard h2 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .btn { display: inline-block; padding: 8px 15px; margin-bottom: 5px; margin-right: 5px; font-size: 0.9em; font-weight: 400; line-height: 1.5; text-align: center; white-space: nowrap; vertical-align: middle; cursor: pointer; border: 1px solid transparent; border-radius: .25rem; text-decoration: none; }
    .btn-primary { color: #fff; background-color: #007bff; border-color: #007bff; }
    .btn-primary:hover { background-color: #0056b3; }
    .btn-secondary { color: #fff; background-color: #6c757d; border-color: #6c757d; }
    .btn-info { color: #fff; background-color: #17a2b8; border-color: #17a2b8; }
    .btn-danger { color: #fff; background-color: #dc3545; border-color: #dc3545; }
    .btn-sm { padding: .25rem .5rem; font-size: .875em; line-height: 1.5; border-radius: .2rem; }
    .table { width: 100%; margin-bottom: 1rem; color: #212529; border-collapse: collapse; }
    .table th, .table td { padding: .75rem; vertical-align: top; border-top: 1px solid #dee2e6; }
    .table thead th { vertical-align: bottom; border-bottom: 2px solid #dee2e6; background-color: #f1f1f1;}
    .badge { display: inline-block; padding: .25em .4em; font-size: 75%; font-weight: 700; line-height: 1; text-align: center; white-space: nowrap; vertical-align: baseline; border-radius: .25rem; }
    .badge-danger { color: #fff; background-color: #dc3545; }
</style>
{% endblock %}