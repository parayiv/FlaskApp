{% extends 'base.html' %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="professional-dashboard">
    <header class="dashboard-main-header">
        <h1 class="page-title">Welcome Back, {{ g.user.username }}</h1>
        <p class="page-subtitle">Hereâ€™s an overview of your HR activities and requests.</p>
    </header>

    <div class="dashboard-layout-grid">
        <!-- Quick Actions Panel -->
        <section class="dashboard-panel quick-actions-panel">
            <h2 class="panel-title">Quick Actions</h2>
            <div class="action-items-container">
                <a href="{{ url_for('send_message') }}" class="action-item">
                    <i class="fas fa-envelope-open-text action-icon"></i>
                    <span class="action-label">Send Message to Admin</span>
                    <i class="fas fa-angle-right chevron"></i>
                </a>
                <a href="{{ url_for('new_request_form', type='payslip') }}" class="action-item">
                    <i class="fas fa-file-invoice-dollar action-icon"></i>
                    <span class="action-label">Request Payslip</span>
                    <i class="fas fa-angle-right chevron"></i>
                </a>
                <a href="{{ url_for('new_request_form', type='vacation') }}" class="action-item">
                    <i class="fas fa-plane-departure action-icon"></i>
                    <span class="action-label">Request Vacation</span>
                    <i class="fas fa-angle-right chevron"></i>
                </a>
            </div>
        </section>

        <!-- Recent Requests Panel -->
        <section class="dashboard-panel recent-requests-panel">
            <div class="panel-header">
                <h2 class="panel-title">Recent Requests</h2>
                {# <a href="#" class="panel-header-link btn btn-sm btn-outline-primary">View All</a> #}
            </div>
            {% if user_requests %}
                <div class="requests-list">
                    {% for req in user_requests[:4] %} {# Show latest 4 for this panel #}
                    <div class="request-summary-item status-border-{{ req.status|lower }}">
                        <div class="request-info">
                            <span class="request-type">
                                <i class="fas {% if req.request_type == 'payslip' %}fa-file-alt{% elif req.request_type == 'vacation' %}fa-umbrella-beach{% else %}fa-clipboard-list{% endif %} fa-fw"></i>
                                {{ req.request_type|capitalize }}
                            </span>
                            <p class="request-details-preview">{{ req.details|truncate(60, True) if req.details else 'No details provided.' }}</p>
                            <span class="request-date">Submitted: {% if req.submitted_at %}{{ req.submitted_at.strftime('%d %b %Y, %H:%M') }}{% else %}N/A{% endif %}</span>
                        </div>
                        <div class="request-status-area">
                            <span class="status-tag status-{{ req.status|lower }}">
                                {{ req.status|capitalize }}
                            </span>
                            {% if req.admin_notes %}
                            <span class="admin-note-indicator" title="{{ req.admin_notes }}">
                                <i class="fas fa-info-circle"></i> Notes
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if user_requests|length > 4 %}
                    <div class="view-all-centered">
                        <a href="#full-history-table" class="btn btn-outline-primary btn-sm">View Full History</a>
                    </div>
                {% endif %}
            {% else %}
                <div class="panel-empty-state">
                    <i class="fas fa-folder-open fa-2x"></i>
                    <p>No requests submitted yet.</p>
                </div>
            {% endif %}
        </section>

        <!-- Full Request History Table (Optional, can be on a separate page) -->
        <section class="dashboard-panel full-history-table-panel" id="full-history-table">
             <h2 class="panel-title">Full Request Log</h2>
            {% if user_requests %}
            <div class="table-responsive-wrapper">
                <table class="professional-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Details</th>
                            <th>Submitted</th>
                            <th>Status</th>
                            <th>Admin Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in user_requests %}
                        <tr>
                            <td><i class="fas {% if req.request_type == 'payslip' %}fa-file-alt{% elif req.request_type == 'vacation' %}fa-umbrella-beach{% else %}fa-clipboard-list{% endif %} fa-fw"></i> {{ req.request_type|capitalize }}</td>
                            <td class="details-column">{{ req.details|truncate(100, True) if req.details else '-' }}</td>
                            <td>{% if req.submitted_at %}{{ req.submitted_at.strftime('%Y-%m-%d') }}{% else %}N/A{% endif %}</td>
                            <td>
                                <span class="status-tag status-{{ req.status|lower }}">
                                    {{ req.status|capitalize }}
                                </span>
                            </td>
                            <td class="notes-column">{{ req.admin_notes|truncate(80, True) if req.admin_notes else '-' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                 <div class="panel-empty-state" style="padding-top:10px;">
                    <p>Your request log is currently empty.</p>
                </div>
            {% endif %}
        </section>
    </div>
</div>

<style>
    .professional-dashboard {
        /* Overall container */
    }

    .dashboard-main-header {
        margin-bottom: 35px;
    }

    .dashboard-layout-grid {
        display: grid;
        grid-template-columns: 1fr; /* Default to single column */
        gap: 30px;
    }
    @media (min-width: 992px) { /* Desktop: 1/3 for actions, 2/3 for requests OR two columns */
        .dashboard-layout-grid {
            grid-template-columns: repeat(2, 1fr); /* Two equal columns */
            /* Or: grid-template-columns: 1fr 2fr;  for unequal */
        }
        .full-history-table-panel { /* Full history spans both columns if present */
             grid-column: 1 / -1;
        }
    }


    .dashboard-panel {
        background-color: var(--card-bg);
        padding: 25px 30px;
        border-radius: var(--border-radius-md);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
    }
    .panel-title {
        font-family: var(--font-family-headings);
        font-weight: 600;
        font-size: 1.35em;
        color: var(--text-color-headings);
        margin-top: 0;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-color);
    }
    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px; /* Added for spacing if link is present */
    }
    .panel-header .panel-title {
        margin-bottom: 0; /* Remove bottom margin/border if using panel-header */
        border-bottom: none;
    }
    .panel-header-link { font-size: 0.85em !important; padding: 6px 12px !important; }


    /* Quick Actions Panel */
    .action-items-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    .action-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: var(--background-color); /* Light background for items */
        border-radius: var(--border-radius-sm);
        text-decoration: none;
        color: var(--text-color-dark);
        transition: background-color 0.2s, box-shadow 0.2s;
        border: 1px solid var(--border-color);
    }
    .action-item:hover {
        background-color: #e9ecef; /* Slightly darker on hover */
        box-shadow: var(--shadow-sm);
    }
    .action-icon {
        font-size: 1.4em;
        color: var(--primary-color);
        margin-right: 15px;
        width: 25px; /* Fixed width for alignment */
        text-align: center;
    }
    .action-label {
        flex-grow: 1;
        font-weight: 500;
        font-size: 1.05em;
    }
    .action-item .chevron {
        font-size: 1em;
        color: var(--text-color-light);
    }

    /* Recent Requests Panel */
    .requests-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    .request-summary-item {
        background-color: var(--background-color);
        padding: 15px;
        border-radius: var(--border-radius-sm);
        display: flex;
        justify-content: space-between;
        align-items: flex-start; /* Align items to top for varied content height */
        border-left: 4px solid var(--border-color); /* Default border */
    }
    .status-border-pending { border-left-color: #ffc107; } /* Bootstrap warning yellow */
    .status-border-approved { border-left-color: #28a745; } /* Bootstrap success green */
    .status-border-rejected { border-left-color: #dc3545; } /* Bootstrap danger red */

    .request-info { flex-grow: 1; margin-right: 15px; }
    .request-type {
        font-weight: 600;
        font-size: 1em;
        color: var(--text-color-headings);
        display: block;
        margin-bottom: 5px;
    }
    .request-type i { color: var(--secondary-color); margin-right: 6px; }
    .request-details-preview {
        font-size: 0.9em;
        color: var(--text-color-light);
        margin-bottom: 8px;
        line-height: 1.5;
    }
    .request-date {
        font-size: 0.8em;
        color: #6c757d;
        display: block;
    }
    .request-status-area { text-align: right; min-width: 120px; }
    .status-tag {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px; /* Pill shape */
        font-size: 0.8em;
        font-weight: 600;
        color: white;
        margin-bottom: 5px;
    }
    .status-pending { background-color: #ffc107; color: #333; }
    .status-approved { background-color: #28a745; }
    .status-rejected { background-color: #dc3545; }
    .admin-note-indicator {
        font-size: 0.8em;
        color: var(--primary-color);
        cursor: help;
        display: block;
    }
    .admin-note-indicator i { margin-right: 4px; }
    .view-all-centered { text-align:center; margin-top: 20px; }


    /* Full History Table */
    .table-responsive-wrapper { overflow-x: auto; margin-top: 10px; }
    .professional-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95em;
    }
    .professional-table th,
    .professional-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }
    .professional-table thead th {
        background-color: #f1f3f5; /* Lighter header */
        font-weight: 600;
        font-family: var(--font-family-headings);
        color: var(--text-color-dark);
        text-transform: uppercase;
        font-size: 0.85em;
        letter-spacing: 0.5px;
    }
    .professional-table tbody tr:hover {
        background-color: #f8f9fa_hover; /* Very subtle hover */
    }
    .professional-table tbody tr:last-child td { border-bottom: none; }
    .professional-table td i.fa-fw { margin-right: 8px; color: var(--text-color-light); }
    .details-column, .notes-column {
        font-size: 0.9em;
        color: var(--text-color-light);
        max-width: 250px; /* Control width of text heavy columns */
        white-space: normal; /* Allow wrapping */
        word-break: break-word;
    }

    .panel-empty-state {
        text-align: center;
        padding: 30px 20px;
        color: var(--text-color-light);
    }
    .panel-empty-state i {
        font-size: 2.5em; /* Larger icon for empty state */
        margin-bottom: 15px;
        color: var(--border-color); /* Muted icon color */
    }

    @media (max-width: 768px) {
        .page-title { font-size: 1.8em; }
        .page-subtitle { font-size: 1em; }
        .panel-title { font-size: 1.2em; }
        .action-item { padding: 12px; }
        .action-label { font-size: 1em; }
        .request-summary-item { flex-direction: column; align-items: stretch; }
        .request-status-area { text-align: left; margin-top: 10px; }
        .professional-table { font-size: 0.9em; }
         /* Consider stacked table for very small screens if needed */
    }

</style>
{% endblock %}